# EP19 跨EP协调与依赖管理

> 📋 **相关文档**: 详见[EP19编译器改进总结](../01_core_design/EP19_编译器改进总结_技术版.md) 和 [EP19开发任务与技术标准](../02_implementation_standards/EP19_开发任务与技术标准_整合版.md)

## EP19在编译器链中的位置

EP19作为Cymbol编译器实现，在整个编译器教学项目中处于关键位置：

```
EP17 (基础编译器) → EP18 (栈式VM) → EP18R (寄存器VM) → EP19 (完整编译器) → EP20 (优化) → EP21 (高级优化)
```

## 与上游EP的依赖关系

### 依赖EP18R
- **虚拟机架构**: EP19的解释器可以编译到EP18R的寄存器虚拟机
- **指令集**: 可复用EP18R的42条寄存器指令
- **ABI约定**: 遵循EP18R的寄存器分配和调用约定

### 与EP18R的接口共享
```cymbol
// EP19编译器 → EP18R虚拟机
int add(int a, int b) {
    return a + b;
}
```

## 与下游EP的协调

### 对接EP20 (优化器)
- **IR格式**: EP19的AST可作为EP20的优化输入
- **测试用例**: 可共享复杂的Cymbol程序测试集
- **性能基准**: 统一的性能测试标准

### 对接EP21 (高级优化)
- **SSA转换**: EP19的类型系统为EP21的SSA提供基础
- **数据流分析**: EP19的符号表支持数据流分析
- **尾递归优化**: EP19的函数调用支持TRO优化

## 跨EP测试策略

### 测试用例复用
1. **基础功能测试**: 所有EP共享基础语法测试
2. **边界情况测试**: 跨EP的边界条件测试
3. **性能基准测试**: 统一的性能评估标准

### 集成测试流程
```bash
# EP19 → EP18R兼容性测试
ep19-compile source.cymbol → ep18r-execute bytecode

# EP19 → EP20优化测试
ep19-generate-ir source.cymbol → ep20-optimize → verify-equivalence
```

## 数据结构共享

### 符号表设计
- **符号表接口**: 与EP18R保持兼容
- **作用域管理**: 统一的嵌套作用域处理
- **类型系统**: 共享基础类型定义

### AST节点设计
- **节点类型**: 保持与前端EP的一致性
- **访问者模式**: 统一的AST遍历接口
- **位置信息**: 标准化的源码位置追踪

## 开发协调计划

### 短期协调（1个月）
- [ ] 验证EP19→EP18R的编译可行性
- [ ] 建立跨EP测试用例共享机制
- [ ] 统一错误消息格式

### 中期协调（3个月）
- [ ] 实现EP19到EP18R的代码生成
- [ ] 建立性能基准测试标准
- [ ] 协调AST和IR格式

### 长期协调（6个月）
- [ ] 实现完整的编译器链集成
- [ ] 建立统一的调试和 profiling 工具
- [ ] 协调高级优化策略

## 技术规范对接

### 类型系统兼容性
```java
// EP19类型定义与EP18R兼容
public class Type {
    // 共享类型检查和转换逻辑
}
```

### 符号解析一致性
- 遵循统一的作用域解析规则
- 保持符号查找算法一致性
- 统一的错误处理和恢复机制

## 质量保证

### 跨EP测试覆盖率
- 基础语法测试: 100%覆盖
- 类型系统测试: 100%覆盖
- 边界情况测试: >90%覆盖
- 性能基准测试: 标准化指标

### 回归测试策略
- 任何EP的修改都需要验证对下游EP的影响
- 建立自动化跨EP测试流程
- 定期执行完整的编译器链测试

---

**维护者**: EP19开发团队  
**最后更新**: 2026-01-10