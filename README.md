# ä»è§£é‡Šè®¡ç®—çš„è§†è§’ï¼šå¦‚ä½•äº²æ‰‹åˆ›é€ ä¸€é—¨ç¼–ç¨‹è¯­è¨€Cyson

## é¡¹ç›®ç®€ä»‹
**æ¯ä¸€ä¸ªwatchå’Œstaréƒ½æ˜¯è¿™åœºæ¢¦å¹»ä¹‹æ—…çš„â›½ï¸ä¸å¹²æŸ´**
[![Security Status](https://www.murphysec.com/platform3/v31/badge/1718907022023983104.svg)](https://www.murphysec.com/console/report/1718907021914931200/1718907022023983104)

[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/whtoo/How_to_implment_PL_in_Antlr4)
**å…´â¤ï¸å¦‚ğŸ”¥ï¼Œå…¶åŠ¿å¦‚é£.æ„è®¸å¦‚æ²¹ï¼Œæ±©æ±©ä¸æ¯ã€‚**

## ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªç³»åˆ—çš„æ•™ç¨‹ï¼Ÿ
æˆ‘ä»å¼€å§‹ç¼–ç¨‹å°±ä¸€ç›´åœ¨æƒ³ï¼Œå¦‚æœæˆ‘æ˜¯ä¸€ä¸ªæ„å›¾è§„åˆ’è€…ï¼Œ
è€Œä¸æ˜¯äººè‚‰ç¼–ç å™¨è¯¥æœ‰å¤šå¥½ã€‚

å› æ­¤ï¼Œæˆ‘ä¸€å¤´æ‰è¿›äº†ç¼–ç¨‹è¯­è¨€æ„é€ å’Œåˆ†æçš„æ±ªæ´‹å¤§æµ·ä¸­å»æ
é‚£æ ¹æˆ‘å¿ƒä¸­çš„å®šæµ·ç¥é’ˆã€‚

ç°åœ¨ï¼Œæˆ‘çœŸæ­£èµ°è¿›äº†ç¼–è¯‘åç«¯å¤„ç†å’Œç¨‹åºåˆ†æåï¼Œæˆ‘æ„Ÿåˆ°è‡ªå·±
æœ‰å¤ªå¤šæƒ³è®°å½•çš„çŸ¥è¯†ã€æŠ€èƒ½ã€æƒ³æ³•ï¼Œä»¥åŠåˆ›é€ å¥½ç”¨çš„æ–°å·¥å…·å’Œæ–°è¿‡ç¨‹ã€‚

æ‰€ä»¥ï¼Œè¿™å°±æ˜¯æˆ‘çš„èµ·ç‚¹ï¼Œå¸Œæœ›ä½ èƒ½å’Œæˆ‘ä¸€æ ·äº«å—è¿™ä¸ªè¿‡ç¨‹ã€‚

## 2. é¡¹ç›®å†…å®¹
### 2.1 å…¨å±€é¸Ÿç°
- [x] [ep1](ep1)--ä½¿ç”¨antlrçš„EBNFè¯­æ³•å®ç°Hello Worldè§£æç¤ºä¾‹ã€‚
- [x] [ep2](ep2)--ä½¿ç”¨g4è¯­æ³•æè¿°åµŒå¥—æ•°ç»„ç»“æ„`{1,2,{3,4..}...}`å¹¶å®ç°éå†æ‰“å°åŠŸèƒ½ã€‚
- [x] [ep3](ep3)--å®ç°åŸºç¡€å››åˆ™è¿ç®—çš„å¾®å‹è®¡ç®—å™¨ã€‚
- [x] [ep4](ep4)--å®ç°æ”¯æŒäº¤äº’å¼è¾“å…¥çš„ç®—æœ¯è¡¨è¾¾å¼è®¡ç®—å™¨ã€‚
- [x] [ep5](ep5)--ä»Javaæºä»£ç ä¸­æå–æ¥å£å®šä¹‰çš„è§£æå·¥å…·ã€‚
- [x] [ep6](ep6)--å®ç°CSVæ–‡ä»¶è§£æå’Œå†…å®¹æå–å·¥å…·ã€‚
- [x] [ep7](ep7)--å®Œæ•´çš„JSONè¯­æ³•è§£æå™¨å®ç°ã€‚
- [x] [ep8](ep8)--ä»æºä»£ç ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘(AST)çš„æå–å™¨ã€‚
- [x] [ep9](ep9)--ep4çš„å¢å¼ºç‰ˆæœ¬ï¼Œæ”¯æŒæ›´å¤šè¿ç®—ç¬¦å’Œé”™è¯¯å¤„ç†ã€‚
- [x] [ep10](ep10)--ep6çš„æ›¿ä»£å®ç°ï¼Œé‡‡ç”¨ä¸åŒçš„è§£æç­–ç•¥ã€‚
- [x] [ep11](ep11)--åŸºäºASTéå†çš„ç®—æœ¯è¡¨è¾¾å¼è§£é‡Šå™¨ã€‚
- [x] [ep12](ep12)--åœ¨ep11åŸºç¡€ä¸Šå¢åŠ å˜é‡å£°æ˜å’Œèµ‹å€¼è¯­å¥æ”¯æŒã€‚
- [x] [ep13](ep13)--ep11çš„ç®€åŒ–å®ç°ç‰ˆæœ¬ï¼Œä¼˜åŒ–äº†è§£é‡Šå™¨ç»“æ„ã€‚
- [x] [ep14](ep14)--å®ç°ç¬¦å·è¡¨æ•°æ®ç»“æ„ï¼Œç”¨äºè®°å½•å˜é‡ä¿¡æ¯ã€‚
- [x] [ep15](ep15)--å®ç°å˜é‡ä½œç”¨åŸŸåˆ†æå’Œå¤„ç†æœºåˆ¶ã€‚
- [x] [ep16](ep16)--å®ç°å˜é‡ç±»å‹æ£€æŸ¥å’Œè§£æï¼Œæ”¯æŒå‡½æ•°ä½œç”¨åŸŸå’Œå‡½æ•°è°ƒç”¨ã€‚
- [x] [ep17](ep17)--å®ç°å‡½æ•°é™æ€ä¾èµ–åˆ†æï¼ˆéè°ƒç”¨å›¾ç”Ÿæˆï¼‰ã€‚
- [x] [ep18](ep18)--åŸºäºæ ˆçš„è™šæ‹Ÿæœºå®ç°ï¼ŒåŒ…å«åŸºç¡€æŒ‡ä»¤é›†è®¾è®¡ã€‚
- [x] [ep19](ep19)--å®ç°ç»“æ„ä½“(record)ç±»å‹ã€å‡½æ•°è°ƒç”¨ç³»ç»Ÿã€è§£é‡Šå™¨æ‰§è¡Œå’Œæ–‡ä»¶ä½œç”¨åŸŸç®¡ç†ã€‚æ”¯æŒç»“æ„ä½“æ–¹æ³•è°ƒç”¨ã€å‡½æ•°å‚æ•°ä¼ é€’ã€ç±»å‹æ£€æŸ¥å’Œå®Œæ•´çš„ç¼–è¯‘æ‰§è¡Œæµç¨‹ã€‚
- [x] [ep20](ep20)--ä¸­é—´è¡¨ç¤º(IR)å’Œå­—èŠ‚ç ç”Ÿæˆå™¨ï¼Œç›®æ ‡ä¸ºep18çš„è™šæ‹Ÿæœºã€‚
- [x] [ep21](ep21)--å®ç°ä¸‰åœ°å€ç (TAC)ç”Ÿæˆã€é™æ€å•èµ‹å€¼(SSA)å½¢å¼å’Œæ§åˆ¶æµå›¾(CFG)åˆ†æã€‚

--------------------
## 4. è™šæ‹Ÿæœºè®¾è®¡ (åŸºäºep18æ¨¡å—)

### 4.1 æŒ‡ä»¤é›†è®¾è®¡
- ç®—æœ¯è¿ç®—æŒ‡ä»¤: iconst, iadd, imul
- æ§åˆ¶æµæŒ‡ä»¤: call, ret, halt
- å†…å­˜è®¿é—®æŒ‡ä»¤: load

### 4.2 å­—èŠ‚ç æ ¼å¼
```
.def å‡½æ•°å: args=å‚æ•°æ•°é‡, locals=å±€éƒ¨å˜é‡æ•°é‡
æŒ‡ä»¤åºåˆ—
```

### 4.3 æ‰§è¡Œæµç¨‹
1. å–æŒ‡ä»¤
2. è§£ç æŒ‡ä»¤
3. éªŒè¯æŒ‡ä»¤åˆæ³•æ€§
4. æ‰§è¡ŒæŒ‡ä»¤
5. æ›´æ–°ç¨‹åºè®¡æ•°å™¨
6. æ£€æŸ¥è¿è¡Œæ—¶çŠ¶æ€

### 4.4 æ ¸å¿ƒç»„ä»¶
- æŒ‡ä»¤åˆ†æ´¾å™¨ (Instruction Dispatcher)
- æ“ä½œæ•°æ ˆ (Operand Stack)
- ç¨‹åºè®¡æ•°å™¨ (Program Counter)
- è¿è¡Œæ—¶çŠ¶æ€å¯„å­˜å™¨ (Runtime Status Register)
- å¼‚å¸¸å¤„ç†å™¨ (Exception Handler)

### 4.5 å†…å­˜ç®¡ç†
- ä»£ç åŒº (å­˜å‚¨å­—èŠ‚ç )
- æ•°æ®åŒº (å…¨å±€å˜é‡)
- æ ˆåŒº (å‡½æ•°è°ƒç”¨æ ˆ)

--------------------
### ç•ªå¤–
â¤ï¸ğŸ‘€: ç»ˆäºå†™å®Œäº†ï¼Œæ„Ÿè§‰å¥½å¿å¿‘ã€‚ä¸è¿‡ï¼Œæˆ‘è¿˜æœ‰å¦å¤–å‡ ä¸ªä¹Ÿæ˜¯ç¼–è¯‘åŸç†ç›¸å…³çš„å‘ä¹Ÿè¦å¡«ã€‚

é¦–å…ˆï¼Œæˆ‘å¾—æ„Ÿè°¢çˆ¶æ¯ï¼Œä»–ä»¬ç»™äº†æˆ‘è«å¤§æ”¯æŒã€‚

å…¶æ¬¡ï¼Œæ„Ÿè°¢æˆ‘è‡ªå·±å’Œæˆ‘çš„å¦»å­ï¼Œå¦‚æœä¸æ˜¯æˆ‘ä»¬çš„ç›¸é‡æˆ‘æ°¸è¿œä¹Ÿä¸èƒ½å†™å®Œã€‚

æœ€åï¼Œæ„Ÿè°¢è¿™ä¸ªæ—¶ä»£ï¼Œæˆ‘éœ€è¦çš„ä¸€åˆ‡éƒ½åœ¨è¿™ä¸ªæ—¶å€™åˆšåˆšå¥½åˆ°æ¥ã€‚

--------------------



## 2. ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªç³»åˆ—çš„æ•™ç¨‹ï¼Ÿ

æˆ‘ä»å¼€å§‹ç¼–ç¨‹å°±ä¸€ç›´åœ¨æƒ³ï¼Œå¦‚æœæˆ‘æ˜¯ä¸€ä¸ªæ„å›¾è§„åˆ’è€…ï¼Œ
è€Œä¸æ˜¯äººè‚‰ç¼–ç å™¨è¯¥æœ‰å¤šå¥½ã€‚

å› æ­¤ï¼Œæˆ‘ä¸€å¤´æ‰è¿›äº†ç¼–ç¨‹è¯­è¨€æ„é€ å’Œåˆ†æçš„æ±ªæ´‹å¤§æµ·ä¸­å»æ
é‚£æ ¹æˆ‘å¿ƒä¸­çš„å®šæµ·ç¥é’ˆã€‚

ç°åœ¨ï¼Œæˆ‘çœŸæ­£èµ°è¿›äº†ç¼–è¯‘åç«¯å¤„ç†å’Œç¨‹åºåˆ†æåï¼Œæˆ‘æ„Ÿåˆ°è‡ªå·±
æœ‰å¤ªå¤šæƒ³è®°å½•çš„çŸ¥è¯†ã€æŠ€èƒ½ã€æƒ³æ³•ï¼Œä»¥åŠåˆ›é€ å¥½ç”¨çš„æ–°å·¥å…·å’Œæ–°è¿‡ç¨‹ã€‚

æ‰€ä»¥ï¼Œè¿™å°±æ˜¯æˆ‘çš„èµ·ç‚¹ï¼Œå¸Œæœ›ä½ èƒ½å’Œæˆ‘ä¸€æ ·äº«å—è¿™ä¸ªè¿‡ç¨‹ã€‚

## 3. å·¥ç¨‹ä½“ç³»ä»‹ç»
æ•´ä¸ªå·¥ç¨‹åŸºäºMavenæ„å»ºï¼Œéœ€è¦ä»¥ä¸‹ç¯å¢ƒæ”¯æŒï¼š
- a. `JDK18+` è¦æ±‚ (æ¨èä½¿ç”¨OpenJDK 18æˆ–æ›´é«˜ç‰ˆæœ¬)
- b. `Maven 3.8+` æ„å»ºå·¥å…·
- c. `Antlr4` è¿è¡Œæ—¶æ”¯æŒ (å·²é€šè¿‡Mavenä¾èµ–ç®¡ç†)

### 3.1 æ„å»ºæµç¨‹
1. å…‹éš†é¡¹ç›®åï¼Œåœ¨æ ¹ç›®å½•æ‰§è¡Œ:
```bash
mvn clean install
```
2. æ„å»ºç‰¹å®šæ¨¡å—(ä»¥ep20ä¸ºä¾‹):
```bash
cd ep20
mvn clean package
```

### 3.2 æ¨¡å—åŒ–é…ç½®
é¡¹ç›®é‡‡ç”¨Mavenå¤šæ¨¡å—ç»“æ„ï¼Œæ¯ä¸ªep*ç›®å½•éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼ŒåŒ…å«:
- `src/main/java` - ä¸»ä»£ç 
- `src/test/java` - æµ‹è¯•ä»£ç 
- `pom.xml` - æ¨¡å—é…ç½®

### 3.3 ä¾èµ–ç®¡ç†
æ‰€æœ‰ä¾èµ–é€šè¿‡Mavenç®¡ç†ï¼Œä¸»è¦ä¾èµ–åŒ…æ‹¬:
- Antlr4è¿è¡Œæ—¶
- Log4jæ—¥å¿—
- Apache Commonså·¥å…·åº“
### 3.1 Build Process
1. After cloning the project, execute in the root directory:
```bash
mvn clean install
```
   This command will build all modules. Note: Some older episodes (ep1-ep15) might have outdated configurations in their `pom.xml` files and may require manual adjustments to build correctly.
2. Build specific module (e.g., ep20):
```bash
cd ep20
mvn clean package
```
   Alternatively, from the project root:
```bash
mvn clean package -pl ep20
```

### 3.2 Modular Configuration
The project uses a Maven multi-module structure. Each `ep*` directory (e.g., `ep1`, `ep20`) is an independent Maven module, typically containing:
- `pom.xml` - Module-specific Maven configuration.
- `src/main/java` - Java source code for the module.
- `src/main/antlr4` - ANTLR grammar files (`.g4`) if the module uses ANTLR. Some older modules might have `.g4` files under `src/main/java`.
- `src/main/resources` - Resource files for the module.
- `src/test/java` - Java test source code.

### 3.3 Dependency Management
All dependencies are managed via Maven. Key dependencies are defined in the parent `pom.xml` and inherited by submodules:
- ANTLR4 runtime (`org.antlr:antlr4`)
- Log4j2 (`org.apache.logging.log4j:log4j-core`, `log4j-api`)
- Apache Commons Lang (`org.apache.commons:commons-lang3`)
- JUnit 5 and AssertJ (for testing)

### 3.4 How to Start (Running Examples)
Once the project is built (e.g., via `mvn clean install`), you can run specific episodes. The `scripts/run.sh` script is provided as a convenience for this.

**Using `run.sh`:**
The script helps compile, run, and test individual modules.
```bash
cd your_project_dir

# General usage:
# ./scripts/run.sh <command> <module_name> [extra_arguments_for_run_command]

# Examples:
./scripts/run.sh compile ep16    # Compile ep16 module
./scripts/run.sh run ep16       # Run ep16 module's main class
# For modules that take input files, like ep20 or ep21:
./scripts/run.sh run ep20 "src/main/resources/t.cymbol"
./scripts/run.sh run ep21 "src/main/resources/t.cymbol"
./scripts/run.sh test ep19      # Run tests for ep19

# View help for run.sh:
./scripts/run.sh help
```
**Note on older episodes (ep1-ep15):** These episodes might have outdated `run.main.entry` configurations in their `pom.xml` files. If `run.sh run <module>` fails for these, you might need to:
1. Check the `pom.xml` of the specific episode and correct the `<run.main.entry>` property to point to the actual main class.
2. Or, run the main class directly using `mvn exec:java -pl <module_name> -Dexec.mainClass="your.main.Class" -Dexec.args="..."`.

**Running without `run.sh` (Standard Maven):**
You can also run modules using standard Maven commands if you know the main class:
```bash
# Example for ep20, assuming its pom.xml has correct run.main.entry
mvn exec:java -pl ep20 -Dexec.args="src/main/resources/t.cymbol"
```

## 4. å‚è€ƒæˆ–è€…æ¨¡ä»¿ææ–™æ¥æº

# ä½¿ç”¨run.shè„šæœ¬
./scripts/run.sh <å‘½ä»¤> <æ¨¡å—å> [é¢å¤–å‚æ•°]

# ç¤ºä¾‹:
./scripts/run.sh compile ep1    # ç¼–è¯‘ep1æ¨¡å—
./scripts/run.sh run ep2       # è¿è¡Œep2æ¨¡å—
./scripts/run.sh test ep3      # è¿è¡Œep3æ¨¡å—çš„æµ‹è¯•
./scripts/run.sh clean ep4     # æ¸…ç†ep4æ¨¡å—
./scripts/run.sh run ep5 "å‚æ•°1 å‚æ•°2" # è¿è¡Œep5æ¨¡å—å¹¶ä¼ é€’å‚æ•°
./scripts/run.sh run ep20 "src/main/resources/t.cymbol" # è¿è¡Œep20æ¨¡å—å¹¶æŒ‡å®šè¾“å…¥æ–‡ä»¶
./scripts/run.sh run ep21 "src/main/resources/t.cymbol" # è¿è¡Œep21æ¨¡å—å¹¶æŒ‡å®šè¾“å…¥æ–‡ä»¶

# æŸ¥çœ‹å¸®åŠ©
./scripts/run.sh help
```

## 4. å‚è€ƒæˆ–è€…æ¨¡ä»¿ææ–™æ¥æº
### 4.1 å¦‚ä½•è§£é‡Šä¸€ä¸ªç¨‹åº
- [è®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Š(SICP)](https://www.zhihu.com/topic/19620884/hot)
- [åŠ¨æ‰‹åšè§£é‡Šå™¨](http://www.craftinginterpreters.com/)
### 4.2 å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨
- [å¦‚ä½•å®ç°ä¸€ä¸ªç¼–ç¨‹è¯­è¨€](http://lisperator.net/pltut/)
- [ç¼–ç¨‹è¯­è¨€çš„å®ç°æ¨¡å¼](https://www.zhihu.com/topic/20116185/hot)
- [Antlr4æƒå¨æŒ‡å—](https://www.antlr.org/)
- [è‡ªé¡¶å‘ä¸‹ç®—ç¬¦ä¼˜å…ˆåˆ†æ(TDOP)](https://github.com/douglascrockford/TDOP)
- [ç¼–è¯‘åŸç†(é¾™æœ¯:smile:)](https://www.zhihu.com/question/21549783/answer/22749476)
