# EP20 - å®Œæ•´ç¼–è¯‘å™¨æ¶æ„

## ğŸ¤– AI Agent å¿«é€ŸæŒ‡å—

### ğŸ¯ EP æ¦‚è¿°
- **ä¸»é¢˜**: ç«¯åˆ°ç«¯ç¼–è¯‘å™¨ã€æ§åˆ¶æµå›¾ï¼ˆCFGï¼‰æ¶æ„ã€ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰ã€ä¼˜åŒ–æ¡†æ¶ã€EP18 VM ä»£ç ç”Ÿæˆ
- **ç›®æ ‡**: å®ç°å®Œæ•´çš„ç¼–è¯‘å™¨æµæ°´çº¿ï¼Œä»Cymbolæºç åˆ°EP18è™šæ‹Ÿæœºå­—èŠ‚ç ï¼Œæ”¯æŒä¼˜åŒ–å’Œä»£ç ç”Ÿæˆ
- **åœ¨ç¼–è¯‘å™¨æµæ°´çº¿ä¸­çš„ä½ç½®**: å®Œæ•´ç¼–è¯‘å™¨ï¼ˆå‰ç«¯ + ä¸­ç«¯ä¼˜åŒ– + åç«¯ä»£ç ç”Ÿæˆï¼‰
- **ä¾èµ–å…³ç³»**: 
  - å†…éƒ¨ä¾èµ–: æ— 
  - å¤–éƒ¨ä¾èµ–: AssertJ (æµ‹è¯•æ–­è¨€), Mockito (æµ‹è¯•æ¨¡æ‹Ÿ), ANTLR4 4.13.2 (è¯­æ³•è§£æ)

### ğŸ“ é¡¹ç›®ç»“æ„
```
ep20/
â”œâ”€â”€ src/main/java/org/teachfx/antlr4/ep20/
â”‚   â”œâ”€â”€ ast/             # ASTèŠ‚ç‚¹ä½“ç³» (CompileUnit, FuncDeclNode, BinaryExprNodeç­‰)
â”‚   â”œâ”€â”€ ir/              # ä¸­é—´è¡¨ç¤ºï¼ˆä¸‰åœ°å€ç ï¼‰(IRNode, Prog, Assign, JMP, CJMPç­‰)
â”‚   â”œâ”€â”€ pass/            # ç¼–è¯‘å™¨é˜¶æ®µ (sematic/TypeChecker, cfg/ControlFlowAnalysisç­‰)
â”‚   â”œâ”€â”€ driver/          # ç¼–è¯‘å™¨é©±åŠ¨ (Phase, ErrorIssuer, Task)
â”‚   â””â”€â”€ debugger/ast/    # è°ƒè¯•å·¥å…· (Dumper, Dumpable)
â”œâ”€â”€ src/main/antlr4/org/teachfx/antlr4/ep20/parser/Cymbol.g4   # Cymbolè¯­æ³•å®šä¹‰
â”œâ”€â”€ docs/                # è¯¦ç»†è®¾è®¡æ–‡æ¡£ (æŠ€æœ¯è®¾è®¡è§„èŒƒã€é¡¹ç›®æ¶æ„è®¾è®¡è§„èŒƒç­‰)
â””â”€â”€ src/test/java/      # å•å…ƒæµ‹è¯• (ArraysTest, OperatorsTest, ThreeAddressCodeTest, CFGBuilderTestç­‰)
```

### ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶
- **å‰ç«¯**: CymbolLexer (è¯æ³•åˆ†æå™¨), CymbolParser (è¯­æ³•åˆ†æå™¨), CymbolASTBuilder (ASTæ„å»ºå™¨)
- **ä¸­ç«¯**: IRBuilder (ä¸­é—´è¡¨ç¤ºæ„å»ºå™¨), CFGBuilder (æ§åˆ¶æµå›¾æ„å»ºå™¨), TypeChecker (ç±»å‹æ£€æŸ¥å™¨)
- **ä¼˜åŒ–å±‚**: ControlFlowAnalysis (æ§åˆ¶æµåˆ†æ), JumpOptimizer (è·³è½¬ä¼˜åŒ–), EmptyLabelEliminator (ç©ºæ ‡ç­¾æ¶ˆé™¤), RedundantJumpRemover (å†—ä½™è·³è½¬ç§»é™¤)
- **åç«¯**: CodeGen (ä»£ç ç”Ÿæˆå™¨ï¼Œç”ŸæˆEP18è™šæ‹Ÿæœºå­—èŠ‚ç )
- **ç¼–è¯‘å™¨é©±åŠ¨**: Phase (ç¼–è¯‘é˜¶æ®µ), ErrorIssuer (é”™è¯¯æŠ¥å‘Š), Task (ç¼–è¯‘ä»»åŠ¡)

### ğŸ”§ æ„å»ºä¸æµ‹è¯•
```bash
# è¿›å…¥ EP20 ç›®å½•
cd ep20

# æ„å»ºé¡¹ç›®
mvn clean compile

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=ArraysTest
mvn test -Dtest=OperatorsTest
mvn test -Dtest=ThreeAddressCodeTest
mvn test -Dtest=CFGBuilderTest

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–¹æ³•
mvn test -Dtest=ArraysTest#testArrayDeclaration
mvn test -Dtest=CFGBuilderTest#testBasicBlockConstruction
```

### ğŸš€ å¸¸ç”¨æ“ä½œ
#### ç¼–è¯‘è¿è¡Œç¤ºä¾‹
```bash
# å®Œæ•´ç¼–è¯‘Cymbolæºç åˆ°EP18è™šæ‹Ÿæœºå­—èŠ‚ç 
mvn compile exec:java -Dexec.mainClass="org.teachfx.antlr4.ep20.driver.CompilerDriver" -Dexec.args="src/main/resources/example.cymbol output.vm"

# è¿è¡Œç‰¹å®šç¼–è¯‘é˜¶æ®µï¼ˆå¦‚åªè¿›è¡Œç±»å‹æ£€æŸ¥ï¼‰
mvn compile exec:java -Dexec.mainClass="org.teachfx.antlr4.ep20.pass.sematic.TypeChecker" -Dexec.args="src/main/resources/example.cymbol"
```

### ğŸ“ å…³é”®æ³¨æ„äº‹é¡¹
1. **å®Œæ•´ç¼–è¯‘å™¨æ¶æ„**: å®ç°ä»æºç åˆ°å­—èŠ‚ç çš„å®Œæ•´æµæ°´çº¿
2. **æ§åˆ¶æµå›¾æ”¯æŒ**: å®Œæ•´çš„CFGæ„å»ºå’Œåˆ†ææ¡†æ¶
3. **ä¸­é—´è¡¨ç¤º**: ä¸‰åœ°å€ç å½¢å¼çš„IRï¼Œä¾¿äºä¼˜åŒ–å’Œä»£ç ç”Ÿæˆ
4. **ä¼˜åŒ–Passæ¶æ„**: å¯æ’æ‹”çš„ä¼˜åŒ–Passï¼Œæ”¯æŒå¹¶è¡Œä¼˜åŒ–
5. **EP18ç›®æ ‡ä»£ç ç”Ÿæˆ**: ç”ŸæˆEP18è™šæ‹Ÿæœºå­—èŠ‚ç ä½œä¸ºåç«¯ç›®æ ‡
6. **Cè¯­è¨€æ ¸å¿ƒç‰¹æ€§**: æ”¯æŒæ•°ç»„ã€ç»“æ„ä½“ã€ç±»å‹è½¬æ¢ã€typedefç­‰ç‰¹æ€§

### ğŸ” è°ƒè¯•æŠ€å·§
1. **ASTå¯è§†åŒ–**: ä½¿ç”¨ `debugger/ast/Dumper` è¾“å‡ºASTç»“æ„
2. **IRæŸ¥çœ‹**: IRBuilderç”Ÿæˆçš„ä¸­é—´è¡¨ç¤ºå¯è¾“å‡ºæŸ¥çœ‹
3. **CFGè°ƒè¯•**: CFGBuilderæ”¯æŒæ§åˆ¶æµå›¾å¯è§†åŒ–è¾“å‡º
4. **é”™è¯¯å®šä½**: ErrorIssueræä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæºç ä½ç½®
5. **é˜¶æ®µè°ƒè¯•**: Phaseç±»æ”¯æŒç¼–è¯‘é˜¶æ®µé—´çš„è°ƒè¯•è¾“å‡º

### ğŸ¤– AI Agent ä»£ç å¼€å‘æŒ‡å—
#### ä»£ç é£æ ¼
- éµå¾ª `AGENTS.md` ä¸­çš„è§„èŒƒ
- åŒ…å‘½å: `org.teachfx.antlr4.ep20.{package}`
- ç±»å‘½å: PascalCase (å¦‚ `ControlFlowAnalysis`, `IRBuilder`)
- æ–¹æ³•å‘½å: camelCase (å¦‚ `buildControlFlowGraph`, `optimizeBasicBlock`)

#### å¸¸è§ä»»åŠ¡æ¨¡å¼
- **æ·»åŠ æ–°è¯­æ³•ç‰¹æ€§**: 1) æ›´æ–°Cymbol.g4è¯­æ³•ï¼Œ2) æ›´æ–°ASTèŠ‚ç‚¹ï¼Œ3) æ›´æ–°IRBuilderæ”¯æŒï¼Œ4) æ›´æ–°ä»£ç ç”Ÿæˆå™¨ï¼Œ5) æ·»åŠ æµ‹è¯•
- **æ·»åŠ ä¼˜åŒ–Pass**: 1) å®ç°æ–°çš„ä¼˜åŒ–Visitorï¼Œ2) æ³¨å†Œåˆ°ä¼˜åŒ–ç®¡é“ï¼Œ3) éªŒè¯ä¼˜åŒ–æ­£ç¡®æ€§ï¼Œ4) æ€§èƒ½æµ‹è¯•
- **æ‰©å±•ç±»å‹ç³»ç»Ÿ**: 1) æ›´æ–°TypeCheckerï¼Œ2) æ›´æ–°IRç±»å‹è¡¨ç¤ºï¼Œ3) æ›´æ–°ä»£ç ç”Ÿæˆç±»å‹å¤„ç†

#### æµ‹è¯•å¼€å‘
- ä½¿ç”¨JUnit 5 + AssertJç¼–å†™æµ‹è¯•
- æµ‹è¯•æ–‡ä»¶æ”¾åœ¨ `src/test/java/org/teachfx/antlr4/ep20/`
- æµ‹è¯•ç±»åä»¥Testç»“å°¾ (å¦‚ `CFGBuilderTest`)
- ä½¿ç”¨Mockitoè¿›è¡Œå•å…ƒæµ‹è¯•æ¨¡æ‹Ÿ

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£
EP20æœ‰å®Œæ•´çš„è®¾è®¡æ–‡æ¡£ä½“ç³»ï¼Œä½äº `docs/` ç›®å½•ï¼š

### æ ¸å¿ƒè®¾è®¡æ–‡æ¡£
- **æŠ€æœ¯è®¾è®¡è§„èŒƒ**: `docs/01_core_design/EP20_æŠ€æœ¯è®¾è®¡è§„èŒƒ.md` (278è¡Œ)
  - è¯­æ³•æ‰©å±•æŠ€æœ¯è®¾è®¡
  - ä¸­é—´è¡¨ç¤ºè®¾è®¡
  - ä¼˜åŒ–ç®—æ³•è®¾è®¡
- **é¡¹ç›®æ¶æ„è®¾è®¡è§„èŒƒ**: `docs/01_core_design/EP20_é¡¹ç›®æ¶æ„è®¾è®¡è§„èŒƒ.md` (433è¡Œ)
  - å®Œæ•´ç¼–è¯‘å™¨æ¶æ„è®¾è®¡
  - ä»è¯æ³•åˆ†æåˆ°ä»£ç ç”Ÿæˆçš„å®Œæ•´æµæ°´çº¿
  - æ¨¡å—åˆ’åˆ†å’Œæ¥å£è®¾è®¡

### å®ç°ä¸æµ‹è¯•æ ‡å‡†
- **TDDå®æ–½æ ‡å‡†**: `docs/02_implementation_standards/EP20_TDDå®æ–½æ ‡å‡†.md`
  - TDDæ–¹æ³•è®ºåœ¨EP20çš„åº”ç”¨
  - æµ‹è¯•é©±åŠ¨å¼€å‘æµç¨‹
- **æµ‹è¯•è§„èŒƒ**: `docs/02_implementation_standards/EP20_æµ‹è¯•è§„èŒƒ.md`
  - æµ‹è¯•ç­–ç•¥å’Œæ¶æ„
  - æµ‹è¯•ç”¨ä¾‹ç¼–å†™è§„èŒƒ

### å¼€å‘è®¡åˆ’
- **å¼€å‘è®¡åˆ’**: `docs/03_development_plans/EP20_å¼€å‘è®¡åˆ’.md`
  - åŠŸèƒ½å®ç°ä¼˜å…ˆçº§
  - å¼€å‘é‡Œç¨‹ç¢‘

### é¡¹ç›®æ€»ç»“
- **é¡¹ç›®æ€»ç»“**: `docs/04_issues_improvements/EP20_é¡¹ç›®æ€»ç»“.md`
  - é¡¹ç›®ç»éªŒæ€»ç»“
  - æ”¹è¿›å»ºè®®

---

## ğŸ”— ç›¸å…³é“¾æ¥
- **[é¡¹ç›®æ ¹ README](../README.md)** - é¡¹ç›®æ•´ä½“ä»‹ç»
- **[AGENTS.md](../AGENTS.md)** - Agentå¼€å‘æŒ‡å—ï¼ŒåŒ…å«æ„å»ºå‘½ä»¤ã€ä»£ç é£æ ¼ç­‰
- **[EP19 README](../ep19/README.md)** - å‰ä¸€ä¸ªEPï¼šCymbolç¼–è¯‘å™¨æ”¹è¿›ç‰ˆ
- **[EP21 README](../ep21/README.md)** - åä¸€ä¸ªEPï¼šé«˜çº§ç¼–è¯‘å™¨ä¼˜åŒ–
- **[EP18 README](../ep18/README.md)** - ç›®æ ‡è™šæ‹Ÿæœºï¼šCymbolè™šæ‹Ÿæœºä¸åƒåœ¾å›æ”¶ç³»ç»Ÿ

---

*æ³¨æ„ï¼šEP20æ˜¯å®Œæ•´çš„ç¼–è¯‘å™¨å®ç°ï¼ŒåŒ…å«å‰ç«¯ã€ä¸­ç«¯ä¼˜åŒ–å’Œåç«¯ä»£ç ç”Ÿæˆã€‚å®ƒä½¿ç”¨EP18ä½œä¸ºç›®æ ‡è™šæ‹Ÿæœºï¼Œå®ç°äº†ä»Cymbolæºç åˆ°å¯æ‰§è¡Œå­—èŠ‚ç çš„å®Œæ•´ç¼–è¯‘è¿‡ç¨‹ã€‚*
