# EP21 æµ‹è¯•è§„èŒƒ

**ç‰ˆæœ¬**: v2.0 (æ•´åˆç‰ˆ) | **æ—¥æœŸ**: 2026-01-09 | **çŠ¶æ€**: æ–‡æ¡£é‡æ„å®Œæˆ
**ç›®çš„**: EP21ç¼–è¯‘å™¨æµ‹è¯•è§„èŒƒå’Œæœ€ä½³å®è·µï¼ˆæ•´åˆç‰ˆï¼‰
**ç›¸å…³æ–‡æ¡£**: [TDDæ‰§è¡Œè®¡åˆ’](../03_development_plans/EP21_TDDæ‰§è¡Œè®¡åˆ’_æ•´åˆç‰ˆ.md) | [ç ”ç©¶ç”Ÿè¿›é˜¶ä»»åŠ¡](ç ”ç©¶ç”Ÿè¿›é˜¶ä»»åŠ¡.md) | [æ¶æ„è®¾è®¡è§„èŒƒ](../01_core_design/æ¶æ„è®¾è®¡è§„èŒƒ.md)

---

## 1. æµ‹è¯•ç­–ç•¥æ¦‚è¿°

### 1.1 æµ‹è¯•é‡‘å­—å¡”æ¨¡å‹

```
         ç«¯åˆ°ç«¯æµ‹è¯• (10%)
             ^
             |
       é›†æˆæµ‹è¯• (30%)
             ^
             |
       å•å…ƒæµ‹è¯• (60%) - åŸºç¡€
```

### 1.2 æµ‹è¯•ç±»å‹å®šä¹‰

#### å•å…ƒæµ‹è¯•ï¼ˆUnit Testsï¼‰
- **æµ‹è¯•ç²’åº¦**: å•ä¸ªç±»æˆ–æ–¹æ³•
- **è¦†ç›–ç‡ç›®æ ‡**: â‰¥85%
- **æ¡†æ¶**: JUnit 5 + AssertJ
- **æ‰§è¡Œé¢‘ç‡**: æ¯æ¬¡æäº¤

**æµ‹è¯•èŒƒå›´**:
- ASTèŠ‚ç‚¹åˆ›å»ºå’Œæ“ä½œ
- IRæŒ‡ä»¤ç”Ÿæˆå’Œä¼˜åŒ–
- æ•°æ®æµåˆ†æç®—æ³•
- ç¬¦å·è¡¨æ“ä½œ

#### é›†æˆæµ‹è¯•ï¼ˆIntegration Testsï¼‰
- **æµ‹è¯•ç²’åº¦**: æ¨¡å—é—´åä½œ
- **éªŒè¯ç›®æ ‡**: æ¥å£å¥‘çº¦
- **æ¡†æ¶**: JUnit 5 + æµ‹è¯•å®¹å™¨
- **æ‰§è¡Œé¢‘ç‡**: æ¯æ—¥æ„å»º

**æµ‹è¯•åœºæ™¯**:
- å®Œæ•´ç¼–è¯‘æµç¨‹
- æ¨¡å—é—´æ•°æ®ä¼ é€’
- é”™è¯¯ä¼ æ’­è·¯å¾„
- æ€§èƒ½è¾¹ç•Œæ¡ä»¶

#### ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆEnd-to-End Testsï¼‰
- **æµ‹è¯•ç²’åº¦**: å®Œæ•´ç³»ç»Ÿ
- **éªŒè¯ç›®æ ‡**: ç”¨æˆ·åœºæ™¯
- **æ¡†æ¶**: è‡ªå®šä¹‰æµ‹è¯•è¿è¡Œå™¨
- **æ‰§è¡Œé¢‘ç‡**: å‘å¸ƒå‰

**æµ‹è¯•åœºæ™¯**:
- æ ‡å‡†ç¨‹åºç¼–è¯‘å’Œæ‰§è¡Œ
- é”™è¯¯å¤„ç†ç”¨æˆ·ä½“éªŒ
- å·¥å…·é“¾å®Œæ•´å·¥ä½œæµ
- æ€§èƒ½å›å½’æµ‹è¯•

---

## 2. æµ‹è¯•æ¨¡æ¿ç¤ºä¾‹

### 2.1 ASTèŠ‚ç‚¹æµ‹è¯•æ¨¡æ¿

#### BinaryExprNodeTest.java

```java
package org.teachfx.antlr4.ep21.test.ast;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.teachfx.antlr4.ep21.ast.expr.BinaryExprNode;
import org.teachfx.antlr4.ep21.ast.expr.IntExprNode;
import org.teachfx.antlr4.ep21.symtab.type.BuiltInTypeSymbol;

import static org.junit.jupiter.api.Assertions.*;

@DisplayName("ASTèŠ‚ç‚¹æµ‹è¯•ï¼šäºŒå…ƒè¡¨è¾¾å¼")
class BinaryExprNodeTest {

    @Test
    @DisplayName("åˆ›å»ºäºŒå…ƒè¡¨è¾¾å¼èŠ‚ç‚¹åº”æ­£ç¡®è®¾ç½®æ“ä½œç¬¦å’Œæ“ä½œæ•°")
    void testBinaryExprCreation() {
        // Arrange
        IntExprNode left = new IntExprNode(10);
        IntExprNode right = new IntExprNode(20);
        BinaryExprNode.OpType op = BinaryExprNode.OpType.ADD;

        // Act
        BinaryExprNode expr = new BinaryExprNode(op, left, right);

        // Assert
        assertEquals(op, expr.getOpType());
        assertEquals(left, expr.getLhs());
        assertEquals(right, expr.getRhs());
    }

    @Test
    @DisplayName("ç±»å‹ä¼ æ’­åº”æ­£ç¡®è®¾ç½®è¡¨è¾¾å¼ç±»å‹")
    void testBinaryExprTypePropagation() {
        // Arrange
        IntExprNode left = new IntExprNode(10);
        left.setType(BuiltInTypeSymbol.intType);

        IntExprNode right = new IntExprNode(20);
        right.setType(BuiltInTypeSymbol.intType);

        BinaryExprNode expr = new BinaryExprNode(
            BinaryExprNode.OpType.ADD, left, right
        );

        // Act
        expr.setType(BuiltInTypeSymbol.intType);

        // Assert
        assertEquals(BuiltInTypeSymbol.intType, expr.getType());
    }

    @ParameterizedTest
    @ValueSource(strings = {"+", "-", "*", "/", "%"})
    @DisplayName("åº”æ”¯æŒæ‰€æœ‰ç®—æœ¯è¿ç®—ç¬¦")
    void testArithmeticOperators(String opString) {
        // Given
        IntExprNode left = new IntExprNode(10);
        IntExprNode right = new IntExprNode(5);

        // When
        BinaryExprNode.OpType op = BinaryExprNode.OpType.fromString(opString);
        BinaryExprNode expr = new BinaryExprNode(op, left, right);

        // Then
        assertNotNull(expr);
        assertEquals(op, expr.getOpType());
    }
}
```

#### FuncDeclNodeTest.java

```java
package org.teachfx.antlr4.ep21.test.ast;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.teachfx.antlr4.ep21.ast.decl.FuncDeclNode;
import org.teachfx.antlr4.ep21.ast.decl.VarDeclListNode;
import org.teachfx.antlr4.ep21.ast.stmt.BlockStmtNode;
import org.teachfx.antlr4.ep21.symtab.type.BuiltInTypeSymbol;

import static org.junit.jupiter.api.Assertions.*;

@DisplayName("ASTèŠ‚ç‚¹æµ‹è¯•ï¼šå‡½æ•°å£°æ˜")
class FuncDeclNodeTest {

    @Test
    @DisplayName("åˆ›å»ºå‡½æ•°å£°æ˜èŠ‚ç‚¹åº”æ­£ç¡®è®¾ç½®å±æ€§")
    void testFuncDeclCreation() {
        // Arrange & Act
        FuncDeclNode func = new FuncDeclNode(
            BuiltInTypeSymbol.intType,
            "testFunc",
            new VarDeclListNode(),
            new BlockStmtNode()
        );

        // Assert
        assertEquals("testFunc", func.getFuncName());
        assertEquals(BuiltInTypeSymbol.intType, func.getRetType());
        assertNotNull(func.getBody());
    }

    @Test
    @DisplayName("å‡½æ•°å‚æ•°åˆ—è¡¨åº”ä¸ºç©ºåˆ—è¡¨")
    void testFuncDeclEmptyParams() {
        // Arrange & Act
        FuncDeclNode func = new FuncDeclNode(
            BuiltInTypeSymbol.intType,
            "testFunc",
            new VarDeclListNode(),
            new BlockStmtNode()
        );

        // Assert
        assertTrue(func.getParams().getDecls().isEmpty());
    }
}
```

### 2.2 IRç”Ÿæˆæµ‹è¯•æ¨¡æ¿

#### IRGenerationTest.java

```java
package org.teachfx.antlr4.ep21.test.ir;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.teachfx.antlr4.ep21.ir.expr.BinExpr;
import org.teachfx.antlr4.ep21.ir.expr.Operand;
import org.teachfx.antlr4.ep21.ir.expr.ConstVal;
import org.teachfx.antlr4.ep21.ir.stmt.Assign;
import org.teachfx.antlr4.ep21.symtab.type.OperatorType;

import static org.junit.jupiter.api.Assertions.*;

@DisplayName("IRç”Ÿæˆæµ‹è¯•")
class IRGenerationTest {

    @Test
    @DisplayName("å¸¸é‡å€¼åº”æ­£ç¡®è½¬æ¢ä¸ºIRèŠ‚ç‚¹")
    void testConstantGeneration() {
        // Arrange
        int value = 42;

        // Act
        ConstVal constVal = new ConstVal(value);

        // Assert
        assertEquals(value, constVal.getIntVal());
        assertTrue(constVal.isInt());
    }

    @Test
    @DisplayName("äºŒå…ƒè¡¨è¾¾å¼åº”æ­£ç¡®ç”ŸæˆIRèŠ‚ç‚¹")
    void testBinaryOpIR() {
        // Arrange
        Operand left = new ConstVal(10);
        Operand right = new ConstVal(20);
        OperatorType op = OperatorType.ADD;

        // Act
        BinExpr binExpr = new BinExpr(op, left, right);

        // Assert
        assertEquals(op, binExpr.getOpType());
        assertEquals(left, binExpr.getLhs());
        assertEquals(right, binExpr.getRhs());
    }

    @Test
    @DisplayName("èµ‹å€¼è¯­å¥åº”æ­£ç¡®åˆ›å»ºIRèŠ‚ç‚¹")
    void testAssignIRGeneration() {
        // Arrange
        OperandSlot dest = OperandSlot.genTemp();
        ConstVal value = new ConstVal(10);

        // Act
        Assign assign = new Assign(dest, value);

        // Assert
        assertEquals(dest, assign.getLhs());
        assertEquals(value, assign.getRhs());
    }
}
```

### 2.3 ç¬¦å·è¡¨æµ‹è¯•æ¨¡æ¿

#### SymbolTableTest.java

```java
package org.teachfx.antlr4.ep21.test.symtab;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.teachfx.antlr4.ep21.symtab.scope.*;
import org.teachfx.antlr4.ep21.symtab.symbol.*;
import org.teachfx.antlr4.ep21.symtab.type.BuiltInTypeSymbol;

import static org.junit.jupiter.api.Assertions.*;

@DisplayName("ç¬¦å·è¡¨æµ‹è¯•")
class SymbolTableTest {

    @Nested
    @DisplayName("å…¨å±€ä½œç”¨åŸŸæµ‹è¯•")
    class GlobalScopeTest {

        @Test
        @DisplayName("å…¨å±€å˜é‡åº”åœ¨å…¨å±€ä½œç”¨åŸŸä¸­å¯è§£æ")
        void testGlobalScope() {
            // Arrange
            GlobalScope globalScope = new GlobalScope();
            VariableSymbol var = new VariableSymbol(
                "globalVar", BuiltInTypeSymbol.intType
            );

            // Act
            globalScope.define(var);

            // Assert
            assertNotNull(globalScope.resolve("globalVar"));
            assertEquals(var, globalScope.resolve("globalVar"));
        }
    }

    @Nested
    @DisplayName("åµŒå¥—ä½œç”¨åŸŸæµ‹è¯•")
    class NestedScopeTest {

        @Test
        @DisplayName("åµŒå¥—ä½œç”¨åŸŸåº”æ”¯æŒç¬¦å·è§£æé“¾")
        void testLocalScopeNesting() {
            // Arrange
            GlobalScope global = new GlobalScope();
            LocalScope local1 = new LocalScope(global);
            LocalScope local2 = new LocalScope(local1);

            VariableSymbol var = new VariableSymbol(
                "var", BuiltInTypeSymbol.intType
            );

            // Act
            local2.define(var);

            // Assert
            assertEquals(var, local2.resolve("var"));
            assertNotNull(local2.resolve("var")); // å‘ä¸ŠæŸ¥æ‰¾
        }
    }
}
```

### 2.4 æ•°æ®æµåˆ†ææµ‹è¯•æ¨¡æ¿

#### LiveVariableAnalyzerTest.java

```java
package org.teachfx.antlr4.ep21.test.analysis;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.teachfx.antlr4.ep21.analysis.dataflow.LiveVariableAnalyzer;
import org.teachfx.antlr4.ep21.ir.IRNode;
import org.teachfx.antlr4.ep21.pass.cfg.BasicBlock;
import org.teachfx.antlr4.ep21.pass.cfg.CFG;

import java.util.Set;

import static org.junit.jupiter.api.Assertions.*;

@DisplayName("æ•°æ®æµåˆ†ææµ‹è¯•ï¼šæ´»è·ƒå˜é‡")
class LiveVariableAnalyzerTest {

    @Test
    @DisplayName("ç®€å•èµ‹å€¼è¯­å¥åº”æ­£ç¡®è¯†åˆ«æ´»è·ƒå˜é‡")
    void testSimpleLiveVariableAnalysis() {
        // æ„å»ºç®€å•çš„CFG
        // å˜é‡xåœ¨å®šä¹‰åè¢«ä½¿ç”¨
        // Setup: x = 10; y = x + 5;

        // éªŒè¯xåœ¨ç¬¬äºŒæ¡æŒ‡ä»¤ä¸­æ˜¯æ´»è·ƒçš„
    }

    @Test
    @DisplayName("æ§åˆ¶æµä¸­åº”æ­£ç¡®è®¡ç®—æ´»è·ƒå˜é‡")
    void testControlFlowLiveVariables() {
        // æµ‹è¯•æ§åˆ¶æµä¸­çš„æ´»è·ƒå˜é‡
        // if (x > 0) { y = x; } else { z = x; }
        // éªŒè¯xåœ¨åˆ†æ”¯å‰åéƒ½æ˜¯æ´»è·ƒçš„
    }
}
```

### 2.5 SSAè½¬æ¢æµ‹è¯•æ¨¡æ¿

#### SSAGraphTest.java

```java
package org.teachfx.antlr4.ep21.test.analysis;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.teachfx.antlr4.ep21.analysis.ssa.SSAGraph;
import org.teachfx.antlr4.ep21.ir.IRNode;
import org.teachfx.antlr4.ep21.pass.cfg.CFG;

import static org.junit.jupiter.api.Assertions.*;

@DisplayName("SSAè½¬æ¢æµ‹è¯•")
class SSAGraphTest {

    @Nested
    @DisplayName("SSAæ„å»ºæµ‹è¯•")
    class SSABuildingTest {

        @Test
        @DisplayName("åº”æ­£ç¡®æ„å»ºSSAå½¢å¼")
        void testSSABuilding() {
            // Given: æ„å»ºCFG
            CFG<IRNode> cfg = buildTestCFG();

            // When: æ„å»ºSSA
            SSAGraph ssaGraph = new SSAGraph(cfg);
            ssaGraph.buildSSA();

            // Then: éªŒè¯Î¦å‡½æ•°æ’å…¥
            // éªŒè¯å˜é‡ç‰ˆæœ¬å·
        }
    }

    @Nested
    @DisplayName("SSAé‡å‘½åæµ‹è¯•")
    class SSARenamingTest {

        @Test
        @DisplayName("åº”æ­£ç¡®é‡å‘½åå˜é‡")
        void testSSARenaming() {
            // æµ‹è¯•å˜é‡é‡å‘½å
            // éªŒè¯ç‰ˆæœ¬æ ˆçš„æ­£ç¡®ç®¡ç†
        }
    }
}
```

---

## 3. æµ‹è¯•æœ€ä½³å®è·µ

### 3.1 å‘½åè§„èŒƒ

- **æµ‹è¯•ç±»**: `è¢«æµ‹è¯•ç±»åTest`
- **æµ‹è¯•æ–¹æ³•**: `testè¢«æµ‹è¯•æ–¹æ³•åœºæ™¯`
- **ç¤ºä¾‹**: `testBinaryOpIR()`

### 3.2 ç»„ç»‡ç»“æ„ï¼ˆAAAæ¨¡å¼ï¼‰

```java
// Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®å’Œå¯¹è±¡
// Act: æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
// Assert: éªŒè¯ç»“æœ
```

### 3.3 æµ‹è¯•åŸåˆ™

1. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
2. **å¯é‡å¤**: ç»“æœä¸ä¾èµ–å¤–éƒ¨ç¯å¢ƒ
3. **å°ç²’åº¦**: æµ‹è¯•å•ä¸ªåŠŸèƒ½ç‚¹
4. **æœ‰æ„ä¹‰çš„æ–­è¨€**: éªŒè¯é‡è¦è¡Œä¸º

### 3.4 æµ‹è¯•åˆ†ç±»

- **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªç±»æˆ–æ–¹æ³•ï¼ˆå 70%ï¼‰
- **é›†æˆæµ‹è¯•**: æµ‹è¯•å¤šä¸ªç»„ä»¶åä½œï¼ˆå 20%ï¼‰
- **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´æµç¨‹ï¼ˆå 10%ï¼‰

---

## 4. å¿«é€Ÿæµ‹è¯•ç”Ÿæˆè„šæœ¬

### 4.1 æµ‹è¯•æ–‡ä»¶åˆ›å»ºè„šæœ¬

```bash
#!/bin/bash
# å¿«é€Ÿç”Ÿæˆæµ‹è¯•ç±»éª¨æ¶

# ASTæµ‹è¯•
for class in BinaryExprNode FuncDeclNode VarDeclNode IfStmtNode WhileStmtNode; do
    testClass="${class}Test"
    cat > "src/test/java/org/teachfx/antlr4/ep21/test/ast/${testClass}.java" <<EOF
package org.teachfx.antlr4.ep21.test.ast;

import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class ${class}Test {

    @Test
    void test${class}Creation() {
        // TODO: å®ç°æµ‹è¯•
        assertTrue(true);
    }
}
EOF
    echo "åˆ›å»ºæµ‹è¯•: ${testClass}"
done
```

### 4.2 è¦†ç›–ç‡é…ç½®

```xml
<!-- pom.xmlä¸­æ·»åŠ Jacocoæ’ä»¶é…ç½® -->
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.11</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

**æ‰§è¡Œè¦†ç›–ç‡æ£€æŸ¥**:
```bash
mvn clean test
mvn jacoco:report
open target/site/jacoco/index.html
```

**è¦†ç›–ç‡ç›®æ ‡**:
- P0é˜¶æ®µï¼š60%
- P1é˜¶æ®µï¼š70%
- P2é˜¶æ®µï¼š80%
- æœ€ç»ˆç›®æ ‡ï¼šâ‰¥85%

### 4.3 JUnit 5 ç‰¹æ€§åº”ç”¨

#### å‚æ•°åŒ–æµ‹è¯•ç¤ºä¾‹

```java
// å‚æ•°åŒ–æµ‹è¯•ç¤ºä¾‹
@ParameterizedTest
@ValueSource(ints = {1, 2, 3, 4, 5})
void testWithParameters(int argument) {
    // ä½¿ç”¨ä¸åŒçš„å‚æ•°è¿è¡Œå¤šæ¬¡
}

// æµ‹è¯•å¥—ä»¶ç»„ç»‡
@Tag("fast")
class FastTests {
    // å¿«é€Ÿæµ‹è¯•
}

@Tag("slow")
class SlowTests {
    // æ…¢é€Ÿæµ‹è¯•
}
```

#### æ‰§è¡Œè®¡åˆ’

**ç¬¬1å‘¨æµ‹è¯•ä»»åŠ¡**:
1. **Day 1-2**: ASTèŠ‚ç‚¹æµ‹è¯•
2. **Day 3-4**: IRç”Ÿæˆæµ‹è¯•
3. **Day 5**: CFGå’Œç¬¦å·è¡¨æµ‹è¯•
4. **Day 6-7**: é›†æˆæµ‹è¯•å’Œè¦†ç›–ç‡æ£€æŸ¥

**ç›®æ ‡**: 60%è¦†ç›–ç‡ï¼Œ100+æµ‹è¯•ç”¨ä¾‹

---

## 5. æµ‹è¯•æ•°æ®ç®¡ç†

### 5.1 æµ‹è¯•æ•°æ®åˆ†ç±»

```
test-data/
â”œâ”€â”€ valid/          # æœ‰æ•ˆç¨‹åº
â”‚   â”œâ”€â”€ simple/     # ç®€å•ç¨‹åº
â”‚   â”œâ”€â”€ complex/    # å¤æ‚ç¨‹åº
â”‚   â””â”€â”€ edge-cases/ # è¾¹ç•Œæƒ…å†µ
â”œâ”€â”€ invalid/        # æ— æ•ˆç¨‹åº
â”‚   â”œâ”€â”€ syntax/     # è¯­æ³•é”™è¯¯
â”‚   â”œâ”€â”€ semantic/   # è¯­ä¹‰é”™è¯¯
â”‚   â””â”€â”€ type/       # ç±»å‹é”™è¯¯
â””â”€â”€ performance/    # æ€§èƒ½æµ‹è¯•ç¨‹åº
```

### 5.2 æµ‹è¯•æ•°æ®ç”Ÿæˆ

1. **æ‰‹åŠ¨ç¼–å†™**: æ ¸å¿ƒæµ‹è¯•ç”¨ä¾‹
2. **ç¨‹åºç”Ÿæˆ**: éšæœºæµ‹è¯•ç”Ÿæˆ
3. **å¤–éƒ¨æµ‹è¯•å¥—ä»¶**: æ ‡å‡†æµ‹è¯•ç¨‹åº
4. **ç”¨æˆ·ç¨‹åºæ”¶é›†**: çœŸå®ä½¿ç”¨åœºæ™¯

### 5.3 æµ‹è¯•æ‰§è¡Œç­–ç•¥

#### æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# å¿«é€Ÿæµ‹è¯• (å¼€å‘æ—¶)
mvn test -Dtest=*Test -DfailIfNoTests=false

# å®Œæ•´æµ‹è¯• (æäº¤å‰)
mvn clean test

# è¦†ç›–ç‡æ£€æŸ¥
mvn jacoco:check
```

#### CI/CDæµæ°´çº¿

```yaml
stages:
  - test
  - coverage
  - integration
  - e2e

jobs:
  unit-tests:
    stage: test
    script: mvn test

  coverage-check:
    stage: coverage
    script: mvn jacoco:check

  integration-tests:
    stage: integration
    script: mvn verify -Pintegration

  e2e-tests:
    stage: e2e
    script: ./scripts/run-e2e-tests.sh
```

---

## 6. æµ‹è¯•è´¨é‡æ ‡å‡†

### 6.1 éªŒæ”¶æ ‡å‡†

- **è¦†ç›–ç‡è¦æ±‚**:
  - æ•´ä½“è¦†ç›–ç‡: â‰¥85%
  - æ ¸å¿ƒæ¨¡å—: â‰¥90%
  - æ–°åŠŸèƒ½æ¨¡å—: 100%

- **è´¨é‡æŒ‡æ ‡**:
  - æ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡
  - æ— ç¼–è¯‘è­¦å‘Š
  - ä»£ç ç¬¦åˆCheckStyleè§„èŒƒ
  - é€šè¿‡SpotBugsé™æ€æ£€æŸ¥

### 6.2 æµ‹è¯•å¤±è´¥å¤„ç†

1. **ç«‹å³ä¿®å¤**: å•å…ƒæµ‹è¯•å¤±è´¥
2. **åˆ†ææ ¹å› **: é›†æˆæµ‹è¯•å¤±è´¥
3. **å›å½’æµ‹è¯•**: ç«¯åˆ°ç«¯æµ‹è¯•å¤±è´¥
4. **æ€§èƒ½åŸºå‡†**: è¶…è¿‡é˜ˆå€¼éœ€ä¼˜åŒ–

---

## 7. é™„å½•ï¼šå¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
mvn test -pl ep21

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=CFGBuilderTest

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn jacoco:report
open target/site/jacoco/index.html

# è¿è¡Œæ€§èƒ½æµ‹è¯•
mvn exec:java -Dexec.mainClass="org.teachfx.antlr4.ep21.test.PerformanceTest"
```

---

**æœ€åæ›´æ–°**: 2026-01-07
**ç»´æŠ¤è€…**: Claude Code
**çŠ¶æ€**: ğŸ“ æµ‹è¯•æ¨¡æ¿æ–‡æ¡£åˆ›å»ºå®Œæˆ
